select query for availability

SELECT 
    ca.availability_id,
    ca.caregiver_id,
    ca.date,
    ca.start_time,
    ca.end_time,
    ca.child_count,
    ca.child_age_service,
    ca.time_offering,

    -- Skills
    GROUP_CONCAT(DISTINCT s.name) AS skills,
    
    -- Preferences
    GROUP_CONCAT(DISTINCT p.name) AS preferences,
    
    -- Languages
    GROUP_CONCAT(DISTINCT l.name) AS languages,
    
    -- Services
    GROUP_CONCAT(DISTINCT so.services) AS services

FROM caregiver_availability AS ca

-- Join Skills
LEFT JOIN caregiver_availability_skills AS cas
    ON ca.availability_id = cas.caregiveravailability_id
LEFT JOIN caregiver_skills AS s
    ON cas.skill_id = s.id

-- Join Preferences
LEFT JOIN caregiver_availability_preferences_accepted AS cap
    ON ca.availability_id = cap.caregiveravailability_id
LEFT JOIN caregiver_preferences AS p
    ON cap.preference_id = p.id

-- Join Languages
LEFT JOIN caregiver_availability_languages_known AS cal
    ON ca.availability_id = cal.caregiveravailability_id
LEFT JOIN caregiver_languages AS l
    ON cal.language_id = l.id

-- Join Services
LEFT JOIN caregiver_availability_services_offering AS caso
    ON ca.availability_id = caso.caregiveravailability_id
LEFT JOIN services_offered AS so
    ON caso.servicesoffered_id = so.services_id

GROUP BY ca.availability_id, ca.caregiver_id, ca.date, ca.start_time, ca.end_time, ca.child_count, ca.child_age_service, ca.time_offering
ORDER BY ca.caregiver_id;
























# General Query

SELECT *
FROM caregiver_availability ca
JOIN caregivers c ON ca.caregiver_id = c.caregiver_id
WHERE 1=1
-- Gender filter
AND (c.gender = :gender OR :gender IS NULL)
-- Country filter
AND (c.country = :country OR :country IS NULL)
-- State filter
AND (c.state = :state OR :state IS NULL)
-- City filter
AND (c.city = :city OR :city IS NULL)
-- Skills filter (assuming skills are stored as comma-separated values or in a separate table)
AND (:skill IS NULL OR FIND_IN_SET(:skill, c.skills) > 0)
-- Preferences filter
AND (:preference IS NULL OR FIND_IN_SET(:preference, c.preferences) > 0)
-- Services filter
AND (:service IS NULL OR FIND_IN_SET(:service, c.services) > 0)
-- Languages filter
AND (:language IS NULL OR FIND_IN_SET(:language, c.languages) > 0)
-- Availability date range
AND (ca.date BETWEEN :min_date AND :max_date OR (:min_date IS NULL AND :max_date IS NULL))
-- Availability time range
AND ((ca.start_time >= :min_time AND ca.end_time <= :max_time) OR (:min_time IS NULL AND :max_time IS NULL))
-- Child count filter
AND (:child_count IS NULL OR ca.child_count = :child_count)
-- Child age filter
AND (:child_age IS NULL OR FIND_IN_SET(:child_age, ca.child_age_service) > 0)
-- Account status (active)
AND c.acc_status = 1
ORDER BY 
-- Optional sorting, default by date
CASE WHEN :sort = 'date_asc' THEN ca.date END ASC,
CASE WHEN :sort = 'date_desc' THEN ca.date END DESC
LIMIT :offset, :limit;





































# Special conditional


SELECT 
    ca.availability_id,
    ca.caregiver_id,
    ci.full_name,
    ci.gender,
    ci.country,
    ci.state,
    ci.city,
    ca.date,
    ca.start_time,
    ca.end_time,
    ca.child_count,
    ca.child_age_service,
    ca.time_offering,

    -- Skills
    GROUP_CONCAT(DISTINCT s.name) AS skills,
    
    -- Preferences
    GROUP_CONCAT(DISTINCT p.name) AS preferences,
    
    -- Languages
    GROUP_CONCAT(DISTINCT l.name) AS languages,
    
    -- Services
    GROUP_CONCAT(DISTINCT so.services) AS services

FROM caregiver_availability AS ca

-- Join caregiver info
JOIN caregiver_info AS ci
    ON ca.caregiver_id = ci.caregiver_id

-- Join Skills
LEFT JOIN caregiver_availability_skills AS cas
    ON ca.availability_id = cas.caregiveravailability_id
LEFT JOIN caregiver_skills AS s
    ON cas.skill_id = s.id

-- Join Preferences
LEFT JOIN caregiver_availability_preferences_accepted AS cap
    ON ca.availability_id = cap.caregiveravailability_id
LEFT JOIN caregiver_preferences AS p
    ON cap.preference_id = p.id

-- Join Languages
LEFT JOIN caregiver_availability_languages_known AS cal
    ON ca.availability_id = cal.caregiveravailability_id
LEFT JOIN caregiver_languages AS l
    ON cal.language_id = l.id

-- Join Services
LEFT JOIN caregiver_availability_services_offering AS caso
    ON ca.availability_id = caso.caregiveravailability_id
LEFT JOIN services_offered AS so
    ON caso.servicesoffered_id = so.services_id

WHERE 1=1
    -- Gender filter
    AND (ci.gender = 'Male' OR 'Male' IS NULL)
    -- Country filter
    AND (ci.country = 'India' OR 'India' IS NULL)
    -- State filter
    AND (ci.state = 'Gujarat' OR 'Gujarat' IS NULL)
    -- City filter
    AND (ci.city = 'Valsad' OR 'Valsad' IS NULL)
    -- Skills filter
    AND ('cr_training' IS NULL OR s.name = 'cr_training')
    -- Preferences filter
    AND ('comfort_with_pets' IS NULL OR p.name = 'comfort_with_pets')
    -- Languages filter
    AND ('hindi' IS NULL OR l.name = 'hindi')
    -- Services filter
    AND ('Personal''s care' IS NULL OR so.services = 'Personal''s care')
    -- Availability date range
    AND (ca.date BETWEEN '2025-12-01' AND '2025-12-31' OR ('2025-12-01' IS NULL AND '2025-12-31' IS NULL))
    -- Availability time range
    AND ((ca.start_time >= '08:00:00' AND ca.end_time <= '17:00:00') OR ('08:00:00' IS NULL AND '17:00:00' IS NULL))
    -- Child count
    AND (1 IS NULL OR ca.child_count = 1)
    -- Child age
    AND ('10+ years' IS NULL OR FIND_IN_SET('10+ years', ca.child_age_service) > 0)
    -- Account status (active)
    AND ci.acc_status = 1

GROUP BY ca.availability_id, ca.caregiver_id, ci.full_name, ci.gender, ci.country, ci.state, ci.city, ca.date, ca.start_time, ca.end_time, ca.child_count, ca.child_age_service, ca.time_offering

ORDER BY ca.caregiver_id;
